#!/usr/bin/env ruby
require 'cgi'
require 'yaml'

require 'bio-publisci'

require 'sinatra/base'
require "sinatra/linkeddata"
require "sinatra/cross_origin"
require 'rack-flash'

class PubliSciServer < Sinatra::Base
  configure do
    enable :sessions
    enable :cross_origin
  end

  set :views, File.dirname(__FILE__) + '/../server/views'
  set :repository, RDF::FourStore::Repository.new('http://localhost:8080')
  # set :repository, RDF::Repository.new
  set :sudo_pass, nil

  use Rack::Flash

  require_relative '../server/helpers.rb'

  if ARGV[0]
    configure_server(ARGV)
  else
    settings.repository.load(File.dirname(__FILE__) + '/../resources/primer.ttl')
  end

  require_relative '../server/routes.rb'


  run!
end